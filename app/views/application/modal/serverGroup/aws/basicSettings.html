<form name="form" class="container-fluid form-horizontal" ng-controller="ServerGroupBasicSettingsCtrl as basicSettingsCtrl" novalidate>
  <div class="modal-body">
    <div class="form-group">
      <div class="col-md-12 well" ng-class="{'alert-danger': form.loadBalancerName.$error.validateUnique, 'alert-info': !form.loadBalancerName.$error.validateUnique}">
        <strong>Your server group will be in the cluster:</strong>
        <span>{{basicSettingsCtrl.getNamePreview()}}</span>
      </div>
    </div>
    <account-select-field label-columns="2" component="command" field="credentials" accounts="accounts" loading="false"></account-select-field>
    <region-select-field label-columns="2" component="command" field="region" account="command.credentials" regions="regions"></region-select-field>
    <subnet-select-field label-columns="2" component="command" field="subnetType" region="command.region" subnets="regionSubnetPurposes"></subnet-select-field>
    <div class="form-group">
      <div class="col-md-2 sm-label-left">
        <b>Stack</b>
        <help-field key="aws.serverGroup.stack"></help-field>
      </div>
      <div class="col-md-3"><input type="text"
                                   class="form-control input-sm"
                                   ng-model="command.stack"/></div>

      <div class="col-md-2 sm-label-right">
        <b>Detail</b>
        <help-field key="aws.serverGroup.detail"></help-field>
      </div>
      <div class="col-md-3"><input type="text"
                                   class="form-control input-sm"
                                   ng-model="command.freeFormDetails"/></div>
    </div>
    <div class="form-group">
      <div class="col-md-2 sm-label-left">
        <b>Image</b>
        <help-field key="aws.serverGroup.imageName"></help-field>
      </div>
      <div class="col-md-7" ng-if="!state.imagesLoaded"><h5 class="loader"> finding images...</h5></div>
      <div class="col-md-10" ng-if="state.imagesLoaded && ctrl.useAllImageSelection()">
        <ui-select ng-model="command.allImageSelection"
                   class="form-control input-sm"
                   required>
          <ui-select-match placeholder="Search for an image...">{{$select.selected.imageName || $select.selected}}</ui-select-match>
          <ui-select-choices repeat="result.imageName as result in allImageSearchResults track by $index"
                             refresh="basicSettingsCtrl.searchImages($select.search)"
                             ui-disable-choice="result.message"
                             reset-search-input="false"
                             refresh-delay="0">
            <span ng-bind-html="result.message"></span>
            <span ng-bind-html="result.imageName | highlight: $select.search"></span>
          </ui-select-choices>
        </ui-select>
        <a ng-if="regionalImages.length > 0" href ng-click="state.queryAllImages = false">Only show images matching "{{packageBase || applicationName}}"</a>
        <help-field key="aws.serverGroup.filterImages"></help-field>
      </div>
      <div class="col-md-10" ng-if="state.imagesLoaded && !ctrl.useAllImageSelection()">
        <ui-select ng-model="command.amiName" class="form-control input-sm" required>
          <ui-select-match placeholder="Pick an image">{{$select.selected.imageName}}</ui-select-match>
          <ui-select-choices repeat="image.imageName as image in regionalImages | filter: $select.search | orderBy: '-imageName'">
            <span ng-bind-html="image.imageName | highlight: $select.search"></span>
          </ui-select-choices>
        </ui-select>
        <a href ng-click="state.queryAllImages = true">Search All Images</a><help-field key="aws.serverGroup.allImages"></help-field>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button ng-disabled="taskMonitor.submitting" class="btn btn-default btn-cancel" ng-click="ctrl.cancel()">Cancel</button>
    <submit-button ng-if="ctrl.showSubmitButton()" is-disabled="form.$invalid || !ctrl.isValid() || taskMonitor.submitting"
                   submitting="taskMonitor.submitting" on-click="ctrl.clone()" is-new="true"></submit-button>
    <button type="button" class="btn btn-primary" ng-click="wizard.nextPage(form.$valid)" ng-disabled="form.$invalid">
      Next <span class="glyphicon glyphicon-chevron-right"></span>
    </button>
  </div>
</form>
