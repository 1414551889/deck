<div ng-controller="CanaryExecutionDetailsCtrl as canaryDetailsCtrl">
  <div class="row">
    <div class="col-md-6">
      <h5>Deployment Configuration</h5>
      <dl class="dl-narrow dl-horizontal">
        <dt>Account</dt>
        <dd><account-tag account="stage.context.account"></account-tag></dd>
        <dt>Region</dt>
        <dd ng-repeat="(region, zones) in stage.context.availabilityZones">{{region}}<br/>({{zones.join(', ')}})</dd>
        <dt>Cluster</dt>
        <dd>{{stage.context | clusterName }}</dd>
        <dt>VPC</dt>
        <dd>{{stage.context.subnetType || '[none]'}}</dd>
        <dt>Strategy</dt>
        <dd>{{stage.context.strategy || '[none]'}}</dd>
        <dt>Capacity</dt>
        <dd ng-if="stage.context.capacity.min === stage.context.capacity.max">{{stage.context.capacity.max}}</dd>
        <dd ng-if="stage.context.capacity.min !== stage.context.capacity.max">
          Min: {{stage.context.capacity.min}},
          Max: {{stage.context.capacity.max}},
          Desired: {{stage.context.capacity.desired}}
        </dd>
      </dl>
    </div>

    <execution-step-details item="stage"></execution-step-details>

  </div>

  <stage-failure-message is-failed="stage.isFailed" message="ctrl.getException(stage)"></stage-failure-message>

  <div class="row" ng-if="stage.isCompleted && stage.context['kato.tasks'][0].resultObjects">
    <div class="col-md-12">
      <div class="well alert alert-info">
        <strong>Deployed:</strong>
        <a ng-repeat="serverGroup in deployed"
           ng-click="$event.stopPropagation()"
           ui-sref="home.applications.application.insight.clusters.serverGroup({application: stage.context.application, serverGroup: serverGroup.name, accountId: stage.context.account, region: serverGroup.region, provider: serverGroup.provider || 'aws'})">
          {{serverGroup.name}}
        </a>
      </div>
    </div>
  </div>
</div>
