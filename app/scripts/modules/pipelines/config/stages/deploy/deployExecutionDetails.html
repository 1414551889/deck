<div>
  <div class="row">
    <div class="col-md-6">
      <h5>Deployment Configuration</h5>
      <dl class="dl-narrow dl-horizontal">
        <dt>Account</dt>
        <dd>{{stage.context.account}}</dd>
        <dt>Region</dt>
        <dd ng-repeat="(region, zones) in stage.context.cluster.availabilityZones">{{region}}<br/>({{zones.join(', ')}})</dd>
        <dt>Cluster</dt>
        <dd>{{stage.context.cluster | clusterName }}</dd>
        <dt>VPC</dt>
        <dd>{{stage.context.cluster.subnetType || '[none]'}}</dd>
        <dt>Strategy</dt>
        <dd>{{stage.context.cluster.strategy || '[none]'}}</dd>
        <dt>Capacity</dt>
        <dd ng-if="stage.context.cluster.capacity.min === stage.context.cluster.capacity.max">{{stage.context.cluster.capacity.max}}</dd>
        <dd ng-if="stage.context.cluster.capacity.min !== stage.context.cluster.capacity.max">
          Min: {{stage.context.cluster.capacity.min}},
          Max: {{stage.context.cluster.capacity.max}},
          Desired: {{stage.context.cluster.capacity.desired}}
        </dd>
      </dl>
    </div>

    <div class="col-md-6">
      <h5>Steps</h5>
      <div class="row">
        <div class="col-md-8">
          <strong>Task</strong>
        </div>
        <div class="col-md-4 text-right">
          <strong>Duration</strong>
        </div>
      </div>
      <div class="row" ng-repeat="task in stage.tasks">
        <div class="col-md-8">
          <span class="small"><status-glyph item="task"></status-glyph></span> {{task.name | robotToHuman }}
        </div>
        <div class="col-md-4 text-right">
          {{task.runningTimeInMs | numericDuration }}
        </div>
      </div>
    </div>
  </div>
  <div class="row" ng-if="stage.isFailed">
    <div class="col-md-12">
      <div class="alert alert-danger">
        <h5>Exception:</h5>
        <p ng-if="stage.context['kato.tasks'][0].exception.message">
          {{stage.context['kato.tasks'][0].exception.message}}
        </p>
        <p ng-if="!stage.context['kato.tasks'][0].exception.message">
          No reason provided.
        </p>
      </div>
    </div>
  </div>
  <div class="row" ng-if="stage.isCompleted && stage.context['kato.tasks'][0].resultObjects">
    <div class="col-md-12">
      <div class="well alert alert-info">
        <strong>Deployed:</strong>
        <a ng-repeat="(region, serverGroup) in stage.context['kato.tasks'][0].resultObjects[0].asgNameByRegion"
           ng-click="$event.stopPropagation()"
           ui-sref="home.applications.application.insight.clusters.serverGroup({application: stage.context.cluster.application, serverGroup: serverGroup, accountId: stage.context.account, region: region})">
          {{serverGroup}}
        </a>
      </div>
    </div>
  </div>
</div>
